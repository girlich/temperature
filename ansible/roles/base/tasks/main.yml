---
- name: Activate the overlay for 1-wire
  lineinfile:
    path: /boot/config.txt
    line: dtoverlay=w1-gpio,gpiopin=4
    regexp: '^dtoverlay=w1.*$'
  become: true
  notify: Reboot temperature
- name: Add an Apt signing key, uses whichever key is at the URL
  ansible.builtin.apt_key:
    url: https://packages.grafana.com/gpg.key
    state: present
  become: true
- name: Add specified repository into sources list
  ansible.builtin.apt_repository:
    repo: deb https://packages.grafana.com/oss/deb stable main
    state: present
  become: true
- name: Install packages
  package:
    name:
      - prometheus
      - grafana
  become: true
- name: Make sure prometheus is running
  ansible.builtin.systemd:
    state: started
    enabled: yes
    name: prometheus
- name: Make sure grafana is running
  ansible.builtin.systemd:
    state: started
    enabled: yes
    name: grafana-server

